<!DOCTYPE html>
<html lang="en">
<head>
	<title>XYZ</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link href="css/style.css" rel="stylesheet"/>
	<link href="css/bootstrap-square.css" rel="stylesheet"/>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</head>

<body>

<div class="container">

	<div class="navbar navbar-inverse sharp-edge">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">XYZ Home Automation</a>
			</div>

			<div class="nav navbar-nav navbar-right">
				<li><a><span class="glyphicon glyphicon-list"></span></a></li>
			</div>
		</div>
	</div>
	
	<div class="container-fluid page-border no-padding">
	
		<div class="row bottom-border" style="width:100%; margin-left:0px;">
			<div class="col-xs-12">
				<h2>Lights <a href="index.html" style="color:green"><span class="glyphicon glyphicon-home pull-right" style="font-size:30px"></span></a></h2>
			</div>
		</div>
	
		<div class="row">
		
			<div id="lightList" class="col-xs-3 right-border" style="padding-right:0px">
				<div class="list-group no-margin">
					<div onclick="loadControl(this);" id="kitchen" class="list-group-item active-list">Kitchen <span class="glyphicon glyphicon-flash pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="dining" class="list-group-item">Dining Room <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="study" class="list-group-item">Study Room <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="garage" class="list-group-item">Garage <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="living" class="list-group-item">Living Room <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="guest" class="list-group-item">Guest Room <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="master" class="list-group-item">Master Bedroom <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="tony" class="list-group-item">Tony's Bedroom <span class="glyphicon pull-right" style="font-size:20px"></span></div>
					<div onclick="loadControl(this);" id="wanda" class="list-group-item">Wanda's Bedroom <span class="glyphicon pull-right" style="font-size:20px"></span></div>
				</div>
			</div>
			
			<div id="lightControl" class="col-xs-9">
			
				<div class="row">
					<div class="col-xs-12 ">
						
						<h2>Intensity</h2>
						
						<div class="row" style="padding-top:10px; padding-right:10px;">
							<div class="col-xs-4">
								<button type="button" class="btn btn-primary center-block btn-block " onclick="lightOff(this)">Off</button>
								<h4 class="text-center"> 0% </h4>
							</div>
							
							<div class="col-xs-4">
								<button type="button" class="btn btn-primary center-block btn-block" onclick="lightOn(this)">Dim</button>
								<h4 class="text-center"> 25% </h4>
							</div>
							
							<div class="col-xs-4">
								<button type="button" class="btn btn-primary center-block btn-block" onclick="lightOn(this)">Eco</button>
								<h4 class="text-center"> 50% </h4>
							</div>
						</div>
						
								
						<div class="row" style="padding-top:10px; padding-right:10px;">
							<div class="col-xs-4">
								<button type="button" class="btn btn-primary center-block btn-block" onclick="lightOn(this)">High</button>
								<h4 class="text-center"> 75% </h4>
							</div>
							
							<div class="col-xs-4">
								<button type="button" class="btn btn-primary center-block btn-block disabled" onclick="lightOn(this)">Max</button>
								<h4 class="text-center"> 100% </h4>
							</div>
							
							<div class="col-xs-4">

							</div>
							
						</div>
						
					</div>
				</div>

				<div class="separator"></div>

				<div class="row">
					<div class="col-xs-12">
					
						<h2>
							Timer
							<button type="button" style="margin-right:10px;" onclick="toggleTime(this)" class="btn btn-primary pull-right" data-toggle="collapse" data-target="#timer">On</button>
						</h2>
						
						<div id="timer" class="collapse">
							
							<div class="row" style="padding-top:10px; padding-right:10px;">
								<div class="col-xs-4">
									<button type="button" class="btn btn-primary center-block btn-block" onclick="cfmTime()">5 min</button>
								</div>
								
								<div class="col-xs-4">
									<button type="button" class="btn btn-primary center-block btn-block" onclick="cfmTime()">15 min</button>
								</div>
								
								<div class="col-xs-4">
									<button type="button" class="btn btn-primary center-block btn-block" onclick="cfmTime()">30 min</button>
								</div>
							</div>
							
									
							<div class="row" style="padding-top:10px; padding-right:10px; padding-bottom:10px;">
								<div class="col-xs-4">
									<button type="button" class="btn btn-primary center-block btn-block" onclick="cfmTime()">1 hr</button>
								</div>
								
								<div class="col-xs-4">
									<button type="button" class="btn btn-primary center-block btn-block" onclick="cfmTime()">2 hr</button>
								</div>
								
								<div class="col-xs-4">
									<button type="button" class="btn btn-primary center-block btn-block" onclick="cfmTime()">3 hr</button>
								</div>
								
							</div>
							
							<div class="row" id="cfmTime" style="padding-top:10px; padding-right:10px; padding-bottom:15px; display:none;">
								<div class="col-xs-12">
									<h3 class="text-center">Timer Set! <span class="glyphicon glyphicon-ok" style="color:green"></span></h3>
								</div>			
							</div>
							
						</div>	
						
					</div>
				</div>
							
			</div>

		</div>

	</div>
	
</div>

<script>
var currentRoom = null;
var currentControl = null;
var currentList = null;


$(document).ready(function(){	
	if (sessionStorage.getItem("first") == "no"){
		//do nothing
	} else {
		sessionStorage.setItem("first", "yes");
	}
    
	loadList();
	loadControl();
	$("#cfmTime").hide();
});

function lightOff(e){
	var temp = "#" + currentRoom + " > span.glyphicon-flash";
	$(temp).removeClass("glyphicon-flash");
	
	$(".btn-block").removeClass("disabled");
	$(e).addClass("disabled");
	
	currentControl = JSON.stringify($("#lightControl").html());	
	sessionStorage.setItem(currentRoom, currentControl);
}

function lightOn(e){
	var temp = "#" + currentRoom + " > span";
	$(temp).addClass("glyphicon-flash");

	$(".btn-block").removeClass("disabled");
	$(e).addClass("disabled");
	
	currentControl = JSON.stringify($("#lightControl").html());	
	sessionStorage.setItem(currentRoom, currentControl);
}

function loadList(){
	
	if ((sessionStorage.getItem("lightList") != null) && (sessionStorage.getItem("lightList") != "")){
		currentList = JSON.parse(sessionStorage.getItem("lightList"));
		$("#lightList").html(currentList);
	} else {
		$("#lightList").load("http://homeauto.azurewebsites.net/lightList.html");
	}
	
	window.onbeforeunload = function() {
		currentList = JSON.stringify($("#lightList").html());	
		sessionStorage.setItem("lightList", currentList);
	}
}

function loadControl(e){	

	currentControl = JSON.stringify($("#lightControl").html());	
	sessionStorage.setItem(currentRoom, currentControl);
	
	if (typeof e === "undefined"){
		currentRoom = "kitchen";
	}
	
	if (sessionStorage.getItem("first") == "yes"){
		currentRoom = "kitchen";	
		sessionStorage.setItem("first", "no");

	} else {
		
		if (typeof e !== "undefined"){
			currentRoom = e.id;
		}
		
		if ((sessionStorage.getItem(currentRoom) != null) && (sessionStorage.getItem(currentRoom) != "")){ //load cached
			currentControl = JSON.parse(sessionStorage.getItem(currentRoom));
			$("#lightControl").html(currentControl);	
		} else {	//load new
			$("#lightControl").load("http://homeauto.azurewebsites.net/lightControl.html");
		}
		
		$(".list-group-item").removeClass("active-list");
		$("#" + currentRoom).addClass("active-list");
		
	}
	
}

function cfmTime(){
	$("#cfmTime").show();
}

function toggleTime(e){
	var currentText = $(e).text();

	if (currentText == "On"){
		$(e).text("Off");
	} else {
		$(e).text("On");
		$("#cfmTime").hide();
	}
}
</script>

</body>

</html>
