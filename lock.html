<!DOCTYPE html>
<html lang="en">
<head>
	<title>XYZ</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link href="css/style.css" rel="stylesheet"/>
	<link href="css/font-awesome.css" rel="stylesheet"/>
	<link href="css/bootstrap-square.css" rel="stylesheet"/>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</head>

<body>

<div class="container">

	<div class="navbar navbar-inverse sharp-edge">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">XYZ Home Automation</a>
			</div>

			<div class="nav navbar-nav navbar-right">
				<li><a><span class="glyphicon glyphicon-list"></span></a></li>
			</div>
		</div>
	</div>
	
	<div class="container-fluid page-border no-padding">
	
		<div class="row bottom-border" style="width:100%; margin-left:0px;">
			<div class="col-xs-12">
				<h2>Locks <a href="index.html" style="color:green"><span class="glyphicon glyphicon-home pull-right" style="font-size:30px"></span></a></h2>
			</div>
		</div>
	
		<div class="row">
		
			<div id="lockList" class="col-xs-3 right-border" style="padding-right:0px">
				<div class="panel-group no-margin">
				
					<div class="panel panel-default">
					
						<div class="panel-heading" data-toggle="collapse" data-target="#collapseOne">
							<h4 class="panel-title">
								<div class="accordion-toggle">Doors</div>
							</h4>
						</div>

						<div id="collapseOne" class="panel-collapse collapse in">
							<div class="list-group no-margin">
								<div onclick="loadDoorControl(this);" id="back" class="list-group-item active-list">Back Door <i class="fa fa-unlock-alt fa-2x pull-right" aria-hidden="true"></i></div>	
								<div onclick="loadDoorControl(this);" id="front" class="list-group-item">Front Door <i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>													
							</div>
						</div>
						
					</div>
					
					<div class="panel panel-default" style="margin-top:0px;">
					
						<div class="panel-heading" data-toggle="collapse"data-target="#collapseTwo">
							<h4 class="panel-title">
								<div class="accordion-toggle">Windows</div>
							</h4>
						</div>
						
						<div id="collapseTwo" class="panel-collapse collapse in">
							<div class="list-group no-margin">
								<div onclick="loadWindowControl(this);" id="garage" class="list-group-item">Garage <i class="fa fa-lock fa-2x pull-right" aria-hidden="false"></i></div>
								<div onclick="loadWindowControl(this);" id="living" class="list-group-item">Living Room<i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>
								<div onclick="loadWindowControl(this);" id="kitchen" class="list-group-item">Kitchen<i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>
								<div onclick="loadWindowControl(this);" id="guest" class="list-group-item">Guest Room<i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>
								<div onclick="loadWindowControl(this);" id="master" class="list-group-item">Master Bedroom<i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>	
								<div onclick="loadWindowControl(this);" id="tony" class="list-group-item">Tony's Bedroom<i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>
								<div onclick="loadWindowControl(this);" id="wanda" class="list-group-item">Wanda's Bedroom<i class="fa fa-lock fa-2x pull-right" aria-hidden="true"></i></div>													
							</div>
						</div>
						
					</div>
					
				</div>
			</div>
			
			<div id="lockControl" class="col-xs-9">
			
				<h2>Change Status</h2>
			
				<div class="row" style="padding-top:10px; padding-right:10px;">
				
					<div class="col-xs-6">
						<button type="button" id="lockBtn" class="btn btn-primary center-block btn-block" onclick="lock(this)">Lock</button>
					</div>
					
					<div class="col-xs-6">
						<button type="button" id="unlockBtn" class="btn btn-primary center-block btn-block disabled" onclick="unlock(this)">Unlock</button>
					</div>
					
				</div>
				
				<div class="separator"></div>
				
				<div class="row">
					<div class="col-xs-12">
					
						<h2>Change PIN</h2>

							<div class="row" style="padding-top:10px;">
							
								<div class="col-xs-12">
									<input type="text" onkeyup="toggleButton(this)" class="form-control" style="width:25%;" placeholder="Current PIN">
								</div>
								
							</div>
							
							<div class="row" style="padding-top:10px;">
							
								<div class="col-xs-12">
									<input type="text" id="newPin" class="form-control" style="width:25%;" placeholder="New PIN" disabled>
								</div>
								
							</div>
							
							<div class="row" style="padding-top:10px; padding-bottom:10px;">
							
								<div class="col-xs-12">
									<button type="button" id="change" class="btn btn-primary disabled">Change</button>
									<button type="button" id="cancel" class="btn btn-primary disabled">Cancel</button>
								</div>

							</div>
						
					</div>
				</div>
				
			</div>

		</div>

	</div>
	
</div>

<script>
var currentRoom = null;
var currentControl = null;
var currentList = null;

$(document).ready(function(){
	if (sessionStorage.getItem("firstDoor") == "no"){
		//do nothing
	} else {
		sessionStorage.setItem("firstDoor", "yes");
	}
	
	loadDoorList();
	loadDoorControl();

});

function lock(e){
	var temp = "#" + currentRoom + " > i";
	$(temp).removeClass("fa-unlock-alt");
	$(temp).addClass("fa-lock");
	
	$("#lockBtn").addClass("disabled");
	$("#unlockBtn").removeClass("disabled");
	
	currentControl = JSON.stringify($("#lockControl").html());	
	sessionStorage.setItem(currentRoom, currentControl);
}

function unlock(e){
	var temp = "#" + currentRoom + " > i";
	$(temp).removeClass("fa-lock");
	$(temp).addClass("fa-unlock-alt");

	$("#lockBtn").removeClass("disabled");
	$("#unlockBtn").addClass("disabled");
	
	currentControl = JSON.stringify($("#lockControl").html());	
	sessionStorage.setItem(currentRoom, currentControl);
}

function loadDoorList(){
	
	if ((sessionStorage.getItem("lockList") != null) && (sessionStorage.getItem("lockList") != "")){
		currentList = JSON.parse(sessionStorage.getItem("lockList"));
		$("#lockList").html(currentList);
	} else {
		$("#lockList").load("http://homeauto.azurewebsites.net/lockList.html");
	}
	
	window.onbeforeunload = function() {
		currentList = JSON.stringify($("#lockList").html());	
		sessionStorage.setItem("lockList", currentList);
	}
}

function loadDoorControl(e){

	if (typeof e === "undefined"){
		currentRoom = "back";
	}
	
	if (sessionStorage.getItem("firstDoor") == "yes"){
		currentRoom = "kitchen";	
		sessionStorage.setItem("firstDoor", "no");

	} else {
		
		if (typeof e !== "undefined"){
			currentRoom = e.id;
		}
		
		if ((sessionStorage.getItem(currentRoom) != null) && (sessionStorage.getItem(currentRoom) != "")){ //load cached
			currentControl = JSON.parse(sessionStorage.getItem(currentRoom));
			$("#lockList").html(currentControl);	
		} else {	//load new
			$("#lockList").load("http://homeauto.azurewebsites.net/lockList.html");
		}
		
		$(".list-group-item").removeClass("active-list");
		$("#" + currentRoom).addClass("active-list");
		
	}
	
	

	/*if (counter == 0){
		currentRoom = "back";
	}

	currentControl = JSON.stringify($("#lockControl").html());
	localStorage[currentRoom] = currentControl;
	
	if (counter != 0){
	
		$(".list-group-item").removeClass("active-list");
		$(e).addClass("active-list");
	
		currentRoom = e.id;

		if (localStorage[currentRoom] != null && localStorage[currentRoom] != ""){ //load cached
			currentControl = JSON.parse(localStorage[currentRoom]);
			$("#lockControl").html(currentControl);	
		} else {	//load new
			$("#lockControl").load("http://homeauto.azurewebsites.net/doorControl.html");
		}
	}

	counter++;*/
	
}

function loadWindowControl(e){


		
	$(".list-group-item").removeClass("active-list");
	$("#" + currentRoom).addClass("active-list");
	
	currentRoom = e.id;
	
	if ((sessionStorage.getItem(currentRoom) != null) && (sessionStorage.getItem(currentRoom) != "")){ //load cached
		currentControl = JSON.parse(sessionStorage.getItem(currentRoom));
		$("#lockControl").html(currentControl);	
	} else {	//load new
		$("#lockControl").load("http://homeauto.azurewebsites.net/windowControl.html");
	}
		

	

	/*currentControl = JSON.stringify($("#lockControl").html());
	localStorage[currentRoom] = currentControl;
	

	
	$(".list-group-item").removeClass("active-list");
	$(e).addClass("active-list");

	currentRoom = e.id;

	if (localStorage[currentRoom] != null && localStorage[currentRoom] != ""){ //load cached
		currentControl = JSON.parse(localStorage[currentRoom]);
		$("#lockControl").html(currentControl);	
	} else {	//load new
		$("#lockControl").load("http://homeauto.azurewebsites.net/windowControl.html");
	}*/

}

function toggleButton(e){
	var temp = e.value;
	
	if (temp != null && temp != ""){
		$('#change').removeClass("disabled");
		$('#cancel').removeClass("disabled");
		$('#newPin').prop('disabled', false);
	} else {
		$('#change').addClass("disabled");
		$('#cancel').addClass("disabled");
		$('#newPin').prop('disabled', true);
	}

}
</script>

</body>

</html>
